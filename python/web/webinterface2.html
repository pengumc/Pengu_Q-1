</script>
<style>
    *{margin:0px;padding:0px;text-decoration:none;font-family:sans-serif;font-size:16px;}
    body{
        background-color:#eee;
    }
    #trace {display:inline-block;vertical-align:top;}
    #page{
        background-color:white;
        border:1px solid #ccc;
        border-bottom:3px solid #ccc;
        border-right:3px solid #ccc;
        margin-top:30px;
        margin-left:auto;
        margin-right:auto;
        width:940px;
        min-height:200px;
        padding:5px;
    }
    .flist{
        border-bottom:1px solid #ccc;
        display:inline-block;
        width:200px;
    }
        .func{
            border:1px solid #ccc;
            border-bottom:none;
            padding:3px;
            background-color:white;
            color:black;
            text-decoration:none;
            font-weight:bold;
            z-index:1;
        
        }
        .func:hover{
            border-right:none;
            background-color:#0075ff;
            color:white;
        }
    #status{
        border:1px solid #ccc;
        margin-bottom:3px;
        height:25px;
    }
        .substatus{
            float:left;
            display:inline-block;
            padding:3px;
            padding-right:10px;
            padding-left:10px;
            border-right:1px solid #ccc;
            font-weight:bold;
        }
        #libloaded{background-color:pink;}
        #usb{background-color:pink;}
        
        
    #data{
        vertical-align:top;
        padding:3px;
        display:inline-block;
        border:1px solid #ccc;
        margin-left:-1px;
        /*border-left:none;*/
        min-height:500px;
        min-width:700px;
        z-index:0;
    }
</style>

</head>
<body>
<div>
<div id="page">
    <div id="status">
        <div id="libloaded" class="substatus">No Library</div>
        <div id="usb" class="substatus">No USB Connection</div>
    </div>
    <div>
    <div class="flist">
        <a href="#" onclick="get_servo_data(this)"><div class="func">get servo data</div></a>
        <a href="#" onclick="is_library_loaded(this)"><div class="func">is_library_loaded </div></a>
        <a href="#" onclick="echo(this)"><div class="func">echo?aap=3&noot=mies</div></a>
        <a href="#" onclick="load_lib(this)"><div class="func">load_lib</div></a>
        <a href="#" onclick="$.ajax({url:'quit'});$('#page').text('server stopped')">
        <div class="func">quit </div></a>
    </div><div id="data">
        data
    </div>
    </div>
</div>
</div>
<div id="trace" style="border:1px solid black"></div>

<script>
//$("#data").hide()
var servos=new Array(12);
var aap;
var libloaded = false;
$(document).ajaxError(function(ev, d){
   alert(d.responseJSON.error);
});
window.addEventListener("keypress",function(){$.ajax({url:"get_servo_data"})})

function sendtest(request){
    $.ajax({
        url:request
    }).success(function traceit(data){trace(data);});

}
function update_func_css(e){
    $(".func").css("border-right","1px solid #ccc");
    $(e).children().css("border-right","5px solid blue");
}

//-------get servo data ---------------------------------------------------------------------------
function get_servo_data(e){
    update_func_css(e);
    $.ajax({url:"get_servo_data"}).success(function(d){
        var el = document.getElementById("data");
        el.innerHTML = "";
        el.innerHTML = d.pw
    });
}
//-------is library loaded-------------------------------------------------------------------------
function is_library_loaded(e){
    update_func_css(e);
    $.ajax({url:"is_library_loaded"}).success(function(d){
        if (d.loaded > 0 ){
            libloaded = true;
        }else{
            libloaded = false;
        }
        $("#data").text(d);
    });
}
//-------echo -------------------------------------------------------------------------------------
function echo(e){
    update_func_css(e);
    $.ajax({url:"echo?aap=3&noot=mies"}).success(function(d){
        $('#data').text(d);
    });
}
//-------load_lib ---------------------------------------------------------------------------------
function load_lib(e){
    update_func_css(e);
    $.ajax({url:"load_lib?path=libcrobot64.dll"}).success(function(d){
        $('#libloaded').css("background-color","lightgreen").text("Library Loaded");
    }).error(function(d){
        err = d.responseJSON.error
        $('#data').text(err)
        if (err == "'already loaded'"){
            $('#libloaded').css("background-color","lightgreen").text("Library Loaded");
        }else{
            $('#libloaded').css("background-color","pink").text("No Library");
        }
    });
}

//=====================
// TRACE
//=====================
function trace(text){
    el = document.getElementById("trace");
    if(el.childNodes.length > 40) el.removeChild(el.childNodes[0]);
    el.innerHTML += "<div>"+text+"</div>";
}
</script>

</body>
</html>
